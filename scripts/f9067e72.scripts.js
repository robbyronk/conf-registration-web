"use strict";angular.module("confRegistrationWebApp",["ngResource","ngCookies","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/admin-dashboard.html",controller:"MainCtrl",resolve:{enforceAuth:"enforceAuth"}}).when("/wizard/:conferenceId",{templateUrl:"views/admin-wizard.html",controller:"AdminWizardCtrl",resolve:{enforceAuth:"enforceAuth",conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}]}}).when("/register/:conferenceId/page/:pageId",{templateUrl:"views/registration.html",controller:"RegistrationCtrl",resolve:{enforceAuth:"enforceAuth",conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}],currentRegistration:["$route","RegistrationCache",function(a,b){return b.getCurrent(a.current.params.conferenceId)}]}}).when("/adminData/:conferenceId",{templateUrl:"views/adminData.html",controller:"AdminDataCtrl",resolve:{enforceAuth:"enforceAuth",registrations:["$route","RegistrationCache",function(a,b){return b.getAllForConference(a.current.params.conferenceId)}],conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}]}}).when("/adminDetails/:conferenceId",{templateUrl:"views/adminDetails.html",controller:"AdminDetailsCtrl",resolve:{enforceAuth:"enforceAuth",registrations:["$route","RegistrationCache",function(a,b){return b.getAllForConference(a.current.params.conferenceId)}],conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}]}}).when("/register/:conferenceId",{resolve:{enforceAuth:"enforceAuth",redirectToRegistration:["$route","ConfCache","$location",function(a,b,c){var d=a.current.params.conferenceId;b.get(d).then(function(){c.replace().path("/register/"+d+"/page/")})}]}}).when("/reviewRegistration/:conferenceId",{templateUrl:"views/reviewRegistration.html",controller:"ReviewRegistrationCtrl",resolve:{enforceAuth:"enforceAuth",registration:["$route","RegistrationCache",function(a,b){return b.getCurrent(a.current.params.conferenceId).then(function(a){return a})}],conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}]}}).when("/payment/:conferenceId",{templateUrl:"views/payment.html",controller:"paymentCtrl",resolve:{enforceAuth:"enforceAuth",registration:["$route","RegistrationCache",function(a,b){return b.getCurrent(a.current.params.conferenceId).then(function(a){return a})}],conference:["$route","ConfCache",function(a,b){return b.get(a.current.params.conferenceId)}]}}).when("/auth/:token",{resolve:{redirectToIntendedRoute:["$location","$cookies","$route","$rootScope",function(a,b,c,d){b.crsToken=c.current.params.token,d.crsToken=b.crsToken,a.replace().path(b.intendedRoute||"/")}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$cookies","$location",function(a,b,c){a.$on("$locationChangeStart",function(){/^\/auth\/.*/.test(c.url())||(b.intendedRoute=c.url())})}]).config(["$httpProvider",function(a){a.interceptors.push("currentRegistrationInterceptor"),a.interceptors.push("httpUrlInterceptor"),a.interceptors.push("authorizationInterceptor"),a.interceptors.push("unauthorizedInterceptor"),a.interceptors.push("debouncePutsInterceptor")}]).run(["$rootScope","$location",function(a,b){a.location=b,a.$watch("location.url()",function(b){a.adminDashboard=angular.equals(b,"/"),a.subHeadStyle={height:a.adminDashboard?"100px":"5px"}})}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate",function(a){return function(b,c){a(b,c),bugsense.notify(b,c)}}])}]),angular.module("confRegistrationWebApp").controller("MainCtrl",["$scope","ConfCache","$modal","$location","$http","Model","uuid",function(a,b,c,d,e,f,g){function h(b,c){e.get("conferences/"+b+"/registrations").success(function(b){a.conferences[c].totalRegistrations=_.filter(b,function(a){return a.completed===!0}).length})}a.$on("conferences/",function(b,c){a.conferences=c;for(var d=0;d<a.conferences.length;d++)h(c[d].id,d)}),b.query(),a.createConference=function(){c.open({templateUrl:"views/createConference.html",controller:"CreateConferenceDialogCtrl",resolve:{defaultValue:function(){return""}}}).result.then(function(a){null===a||""===a||angular.isUndefined(a)||b.create(a).then(function(a){d.path("/wizard/"+a.id)})})},a.cloneConference=function(h){var i=_.find(a.conferences,{id:h});c.open({templateUrl:"views/cloneConference.html",controller:"CreateConferenceDialogCtrl",resolve:{defaultValue:function(){return i.name+" (clone)"}}}).result.then(function(a){null===a||""===a||angular.isUndefined(a)||b.create(a).then(function(a){e.get("conferences/"+i.id).success(function(b){a.acceptCreditCards=b.acceptCreditCards,a.authnetId=b.authnetId,a.conferenceCost=b.conferenceCost,a.contactPersonEmail=b.contactPersonEmail,a.contactPersonName=b.contactPersonName,a.contactPersonPhone=b.contactPersonPhone,a.description=b.description,a.earlyRegistrationAmount=b.earlyRegistrationAmount,a.earlyRegistrationDiscount=b.earlyRegistrationDiscount,a.earlyRegistrationCutoff=b.earlyRegistrationCutoff,a.eventEndTime=b.eventEndTime,a.eventStartTime=b.eventStartTime,a.locationAddress=b.locationAddress,a.locationCity=b.locationCity,a.locationName=b.locationName,a.locationState=b.locationState,a.locationZipCode=b.locationZipCode,a.minimumDeposit=b.minimumDeposit,a.registrationEndTime=b.registrationEndTime,a.registrationStartTime=b.registrationStartTime,a.totalSlots=b.totalSlots,a.registrationPages=b.registrationPages;for(var c=0;c<a.registrationPages.length;c++){var e=g();a.registrationPages[c].id=e,a.registrationPages[c].conferenceId=a.id;for(var h=0;h<a.registrationPages[c].blocks.length;h++)a.registrationPages[c].blocks[h].id=g(),a.registrationPages[c].blocks[h].pageId=e}f.update("conferences/"+a.id,a,function(){d.path("/adminData/"+a.id)})})})})}}]);