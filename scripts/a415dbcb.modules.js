"use strict";angular.module("confRegistrationWebApp").factory("Conferences",["$resource",function(a){return a("conferences/:id")}]),angular.module("confRegistrationWebApp").service("ConfCache",["$cacheFactory","$rootScope","$http","$q",function(a,b,c,d){var e=a("conf"),f=function(a){return"conferences/"+(a||"")},g=function(a,b){var d=e.get(a);angular.isDefined(d)?b(d,a):c.get(a).success(function(c){e.put(a,c),b(c,a)})};this.query=function(a){g(f(a),function(a,c){b.$broadcast(c,a)})},this.get=function(a){var b=d.defer();return g(f(a),function(a){b.resolve(a)}),b.promise}}]),angular.module("confRegistrationWebApp").controller("RegistrationCtrl",["$scope","conference","$routeParams","$location",function(a,b,c,d){function e(a){for(var c=b.pages,d=0;d<c.length;d++)if(angular.equals(a,c[d].id))return c[d]}function f(a){for(var c=b.pages,d=0;d<c.length;d++)if(angular.equals(a,c[d].id))return c[d+1]}a.validPages={},a.$on("pageValid",function(b,c){b.stopPropagation(),a.validPages[b.targetScope.page.id]=c}),a.conference=b;var g=c.pageId;a.activePageId=g,a.page=e(g),a.nextPage=f(g),a.validateAndGoToNext=function(){d.path("/register/"+b.id+"/page/"+a.nextPage.id)}}]),angular.module("confRegistrationWebApp").directive("textQuestion",function(){return{templateUrl:"views/textQuestion.html",restrict:"E"}}),angular.module("confRegistrationWebApp").directive("radioQuestion",function(){return{templateUrl:"views/radioQuestion.html",restrict:"E"}}),angular.module("confRegistrationWebApp").directive("emailQuestion",function(){return{templateUrl:"views/emailQuestion.html",restrict:"E"}}),angular.module("confRegistrationWebApp").directive("nameQuestion",function(){return{templateUrl:"views/nameQuestion.html",restrict:"E"}}),angular.module("confRegistrationWebApp").directive("page",function(){return{templateUrl:"views/pageDirective.html",restrict:"E",controller:["$scope",function(a){a.$watch("pageForm.$valid",function(b){a.$emit("pageValid",b)})}]}}),angular.module("confRegistrationWebApp").directive("block",function(){return{templateUrl:"views/blockDirective.html",restrict:"E",controller:["$scope","AnswerCache",function(a,b){b.syncByBlockId(a,"answer",a.block.id)}]}}),angular.module("confRegistrationWebApp").controller("InfoCtrl",["$scope","conference",function(a,b){a.conference=b,a.page=b.landingPage}]),angular.module("confRegistrationWebApp").factory("Registrations",["$resource","$http","$q",function(a,b,c){var d={},e={getAllForConference:{method:"GET",url:"conferences/:conferenceId/registrations",isArray:!0}},f=a("registrations/:id",d,e);return f.getCurrentOrCreate=function(a){var d=c.defer();return b.get("conferences/"+a+"/registrations/current").success(d.resolve).error(function(b,c){404===c?f.create(a).then(d.resolve):d.reject(b)}),d.promise},f.create=function(a){var d=c.defer();return b.post("conferences/"+a+"/registrations").success(d.resolve),d.promise},f}]),angular.module("confRegistrationWebApp").controller("AdminDataCtrl",["$scope","registrations","conference",function(a,b,c){a.conference=c,a.blocks=[],a.reversesort=!1,angular.forEach(c.pages,function(b){angular.forEach(b.blocks,function(b){-1===b.type.indexOf("Content")&&a.blocks.push(b)})}),a.findAnswer=function(a,b){return _.find(a.answers,function(a){return angular.equals(a.block,b)})},a.answerSort=function(b){return angular.isDefined(a.order)?angular.isDefined(a.findAnswer(b,a.order))?a.findAnswer(b,a.order).value:void 0:0},a.setOrder=function(b){a.reversesort=b===a.order?!a.reversesort:!1,a.order=b},a.registrations=b}]),angular.module("confRegistrationWebApp").constant("uuid",function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})}),angular.module("confRegistrationWebApp").service("AnswerCache",["$cacheFactory","$rootScope","$http","$q",function(a,b,c,d){var e=a("answers"),f=a("blockIndex"),g=function(a){return"answers/"+(a||"")},h=function(a,c){i(c),e.put(a,c),f.put(c.block,c),b.$broadcast(a,c)},i=function(a){c.put(g(a.id),a)},j=function(a,b){var d=e.get(a);angular.isDefined(d)?b(d,a):c.get(a).success(function(c){e.put(a,c),b(c,a)})};this.query=function(a){j(g(a),function(a,c){b.$broadcast(c,a)})},this.get=function(a){var b=d.defer();return j(g(a),function(a){b.resolve(a)}),b.promise},this.put=function(a){h(g(a.id),a)},this.syncByBlockId=function(a,b,c){a[b]=f.get(c),a.$watch(b,function(a){angular.isDefined(a)&&h(g(a.id),a)},angular.equals)}}]),angular.module("confRegistrationWebApp").service("RegistrationCache",["$cacheFactory","$rootScope","$http","$q","AnswerCache",function(a,b,c,d,e){var f=a("registration"),g=function(a){return"registrations/"+(a||"")},h=function(a,c){f.put(a,c),b.$broadcast(a,c)},i=function(a,b){var d=f.get(a);angular.isDefined(d)?b(d,a):c.get(a).success(function(c){h(a,c),b(c,a)})};this.query=function(a){i(g(a),function(a,c){b.$broadcast(c,a)})},this.get=function(a){var b=d.defer();return i(g(a),b.resolve),b.promise},this.getCurrent=function(a){var b=d.defer();return i("conferences/"+a+"/registrations/current",function(a){h(g(a.id),a),angular.forEach(a.answers,e.put),b.resolve(a)}),b.promise}}]),angular.module("confRegistrationWebApp").factory("currentRegistrationInterceptor",["$q","$injector",function(a,b){return{responseError:function(c){var d=/conferences\/[-a-zA-Z0-9]+\/registrations\/current\/?$/;if(404===c.status&&d.test(c.config.url)){var e=c.config.url.split("/");return e.pop(),b.get("$http").post(e.join("/"))}return a.reject(c)}}}]);